<!--pages/admin-products/admin-products.wxml-->
<view class="admin-products-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-actions">
      <view class="add-btn" bindtap="onAddProduct">
        <text class="add-icon">+</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stat-item">
        <view class="stat-number">{{statistics.total}}</view>
        <view class="stat-label">å•†å“æ€»é‡</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{statistics.active}}</view>
        <view class="stat-label">åœ¨å”®ä¸­</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{statistics.inactive}}</view>
        <view class="stat-label">å·²ä¸‹æ¶</view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <view class="search-container">
      <view class="search-icon">ğŸ”</view>
      <input 
        class="search-input" 
        placeholder="æœç´¢å¹´é¾„æ®µã€æˆè‰²ã€æœ¬æ•°..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        confirm-type="search"
      />
      <view wx:if="{{searchKeyword}}" class="search-clear" bindtap="onClearSearch">
        <text>Ã—</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filter-section">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-tags">
        <view 
          class="filter-tag {{currentFilter === '' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter=""
        >
          å…¨éƒ¨
        </view>
        <view 
          wx:for="{{ageGroups}}" 
          wx:key="id"
          class="filter-tag {{currentFilter === item.age_group ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter="{{item.age_group}}"
        >
          {{item.age_group}}
        </view>
        <view 
          class="filter-tag {{currentFilter === 'inactive' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter="inactive"
        >
          å·²ä¸‹æ¶
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="products-section">
    <view wx:for="{{filteredAgeGroups}}" wx:key="id" class="age-group-card">
      <!-- å¹´é¾„æ®µå¤´éƒ¨ -->
      <view class="age-group-header">
        <view class="age-group-info">
          <view class="age-group-details">
            <view class="age-group-title">
              <text class="age-text">{{item.age_group}}ç»˜æœ¬ç›²ç›’</text>
            </view>
          </view>
        </view>
        <view class="age-group-toggle">
          <switch 
            checked="{{item.status === 'active'}}"
            bindchange="onToggleAgeGroup"
            data-age-group="{{item.age_group}}"
            color="#EF5BA6"
          />
        </view>
      </view>

      <!-- SKUåˆ—è¡¨ -->
      <view class="sku-list">
        <view wx:for="{{item.skus}}" wx:key="id" wx:for-item="sku" class="sku-item">
          <view class="sku-info">
            <view class="sku-spec">
              <text class="condition">{{sku.condition}}</text>
              <text class="divider">Â·</text>
              <text class="count">{{sku.book_count}}æœ¬è£…</text>
            </view>
            <view class="sku-price">
              <text class="current-price">Â¥{{sku.price}}</text>
              <view class="stock-info {{sku.stock_status}}">
                <text>åº“å­˜{{sku.stock}}</text>
              </view>
            </view>
          </view>
          
          <view class="sku-actions">
            <view class="action-btn" bindtap="onEditSku" data-sku="{{sku}}">
              <text>ç¼–è¾‘</text>
            </view>
            <view class="action-btn {{sku.status === 'active' ? 'online' : 'offline'}}" 
                  bindtap="onToggleSku" data-sku="{{sku}}">
              <text>{{sku.status === 'active' ? 'ä¸Šæ¶' : 'ä¸‹æ¶'}}</text>
            </view>
            <view class="action-btn delete-btn" bindtap="onDeleteSku" data-sku="{{sku}}">
              <text>åˆ é™¤</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{filteredAgeGroups.length === 0}}" class="empty-state">
    <view wx:if="{{searchKeyword}}" class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å•†å“</view>
    <view wx:else class="empty-text">æš‚æ— å•†å“æ•°æ®</view>
    <view wx:if="{{searchKeyword}}" class="empty-desc">
      <text>æœç´¢"{{searchKeyword}}"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å•†å“</text>
      <text class="clear-search-text" bindtap="onClearSearch">æ¸…é™¤æœç´¢</text>
    </view>
    <view wx:else class="empty-desc">ç‚¹å‡»å³ä¸Šè§’æ·»åŠ æŒ‰é’®åˆ›å»ºå•†å“</view>
  </view>
  
  <!-- ç®¡ç†ç«¯åº•éƒ¨å¯¼èˆª -->
  <view class="admin-tabbar">
    <view class="tab-item {{currentTab === 'home' ? 'active' : ''}}" bindtap="onTabSwitch" data-tab="home">
      <view class="tab-icon">ğŸ </view>
      <view class="tab-text">é¦–é¡µ</view>
    </view>
    <view class="tab-item {{currentTab === 'products' ? 'active' : ''}}" bindtap="onTabSwitch" data-tab="products">
      <view class="tab-icon">ğŸ“¦</view>
      <view class="tab-text">å•†å“</view>
    </view>
    <view class="tab-item {{currentTab === 'orders' ? 'active' : ''}}" bindtap="onTabSwitch" data-tab="orders">
      <view class="tab-icon">ğŸ“‹</view>
      <view class="tab-text">è®¢å•</view>
    </view>
    <view class="tab-item {{currentTab === 'users' ? 'active' : ''}}" bindtap="onTabSwitch" data-tab="users">
      <view class="tab-icon">ğŸ‘¥</view>
      <view class="tab-text">ç”¨æˆ·</view>
    </view>
    <view class="tab-item {{currentTab === 'settings' ? 'active' : ''}}" bindtap="onTabSwitch" data-tab="settings">
      <view class="tab-icon">âš™ï¸</view>
      <view class="tab-text">è®¾ç½®</view>
    </view>
  </view>
</view>

<!-- SKUç¼–è¾‘å¼¹çª— -->
<view wx:if="{{showEditModal}}" class="modal-overlay" bindtap="onCloseEditModal">
  <view class="edit-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">ç¼–è¾‘SKU</view>
      <view class="modal-close" bindtap="onCloseEditModal">Ã—</view>
    </view>
    
    <view class="modal-body">
      <view class="form-item">
        <view class="form-label">å¹´é¾„æ®µ</view>
        <picker mode="selector" range="{{ageGroupOptions}}" value="{{editForm.ageIndex}}" bindchange="onAgeChange">
          <view class="form-input">{{ageGroupOptions[editForm.ageIndex] || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      
      <view class="form-item">
        <view class="form-label">æˆè‰²</view>
        <picker mode="selector" range="{{conditionOptions}}" value="{{editForm.conditionIndex}}" bindchange="onConditionChange">
          <view class="form-input">{{conditionOptions[editForm.conditionIndex] || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      
      <view class="form-item">
        <view class="form-label">æœ¬æ•°</view>
        <picker mode="selector" range="{{countOptions}}" value="{{editForm.countIndex}}" bindchange="onCountChange">
          <view class="form-input">{{countOptions[editForm.countIndex] || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      
      <view class="form-item">
        <view class="form-label">å”®ä»·</view>
        <input class="form-input" type="digit" placeholder="è¯·è¾“å…¥å”®ä»·" 
               value="{{editForm.price}}" bindinput="onPriceInput" />
      </view>
      
      <view class="form-item">
        <view class="form-label">åº“å­˜</view>
        <input class="form-input" type="number" placeholder="è¯·è¾“å…¥åº“å­˜æ•°é‡" 
               value="{{editForm.stock}}" bindinput="onStockInput" />
      </view>
    </view>
    
    <view class="modal-footer">
      <view class="modal-btn cancel" bindtap="onCloseEditModal">å–æ¶ˆ</view>
      <view class="modal-btn confirm" bindtap="onSaveEdit">ä¿å­˜</view>
    </view>
  </view>
</view>

<!-- æ·»åŠ å•†å“å¼¹çª— -->
<view wx:if="{{showAddModal}}" class="modal-overlay" bindtap="onCloseAddModal">
  <view class="edit-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">æ·»åŠ å•†å“</view>
      <view class="modal-close" bindtap="onCloseAddModal">Ã—</view>
    </view>
    
    <view class="modal-body">
      <view class="form-item">
        <view class="form-label">å¹´é¾„æ®µ</view>
        <picker mode="selector" range="{{ageGroupOptions}}" value="{{addForm.ageIndex}}" bindchange="onAddAgeChange">
          <view class="form-input">{{ageGroupOptions[addForm.ageIndex] || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      
      <view class="form-item">
        <view class="form-label">æˆè‰²</view>
        <picker mode="selector" range="{{conditionOptions}}" value="{{addForm.conditionIndex}}" bindchange="onAddConditionChange">
          <view class="form-input">{{conditionOptions[addForm.conditionIndex] || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      
      <view class="form-item">
        <view class="form-label">æœ¬æ•°</view>
        <picker mode="selector" range="{{countOptions}}" value="{{addForm.countIndex}}" bindchange="onAddCountChange">
          <view class="form-input">{{countOptions[addForm.countIndex] || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      
      <view class="form-item">
        <view class="form-label">å”®ä»·</view>
        <input class="form-input" type="digit" placeholder="è¯·è¾“å…¥å”®ä»·" 
               value="{{addForm.price}}" bindinput="onAddPriceInput" />
      </view>
      
      <view class="form-item">
        <view class="form-label">åº“å­˜</view>
        <input class="form-input" type="number" placeholder="è¯·è¾“å…¥åº“å­˜æ•°é‡" 
               value="{{addForm.stock}}" bindinput="onAddStockInput" />
      </view>
    </view>
    
    <view class="modal-footer">
      <view class="modal-btn cancel" bindtap="onCloseAddModal">å–æ¶ˆ</view>
      <view class="modal-btn confirm" bindtap="onSaveAdd">æ·»åŠ </view>
    </view>
  </view>
</view> 