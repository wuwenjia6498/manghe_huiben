<!--pages/order/order.wxml-->
<view class="order-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar">
    <!-- ç©ºç™½å¯¼èˆªæ ï¼Œä¿æŒå“ç‰Œè‰²èƒŒæ™¯ -->
  </view>

  <!-- è®¢å•æ ‡é¢˜åŒºåŸŸ -->
  <view class="order-header">
    <view class="order-back-btn" bindtap="onBackTap">
      <image src="/images/back-arrow-gray.svg" class="back-arrow-icon" />
    </view>
    <view class="order-title-section">
      <text class="order-title">ç¡®è®¤è®¢å•</text>
    </view>
    <view class="order-placeholder"></view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <view class="order-content">
    <!-- æ”¶è´§åœ°å€ -->
    <view class="address-section">
      <view class="section-header">
        <view class="section-icon">ğŸ“</view>
        <view class="section-title">æ”¶è´§åœ°å€</view>
      </view>
      
      <!-- æœ‰åœ°å€æ—¶æ˜¾ç¤º -->
      <view wx:if="{{hasAddress}}" class="address-card" bindtap="onSelectAddress">
        <view class="address-info">
          <view class="address-name">{{addressInfo.name}} {{addressInfo.phone}}</view>
          <view class="address-detail">{{addressInfo.detail}}</view>
        </view>
        <view class="address-arrow">></view>
      </view>
      
      <!-- æ— åœ°å€æ—¶æ˜¾ç¤ºæç¤º -->
      <view wx:else class="empty-address-card" bindtap="onAddAddress">
        <view class="empty-address-icon">ğŸ“</view>
        <view class="empty-address-text">æš‚æ— æ”¶è´§åœ°å€ï¼Œè¯·æ·»åŠ </view>
        <view class="address-arrow">></view>
      </view>
      
      <!-- æ·»åŠ æ–°åœ°å€æŒ‰é’® -->
      <view wx:if="{{hasAddress}}" class="add-address" bindtap="onAddAddress">
        <view class="add-icon">+</view>
        <view class="add-text">æ·»åŠ æ–°åœ°å€</view>
      </view>
    </view>

    <!-- å•†å“ä¿¡æ¯ -->
    <view class="goods-section">
      <view class="section-header">
        <view class="section-icon">ğŸ“¦</view>
        <view class="section-title">å•†å“ä¿¡æ¯</view>
      </view>
      
      <view class="goods-list">
        <view class="goods-item" wx:for="{{orderItems}}" wx:key="id">
          <view class="goods-info">
            <view class="goods-name">{{item.name}}</view>
            <view class="goods-tags">
              <text class="tag">{{item.age}}</text>
              <text class="tag">{{item.condition}}</text>
              <text class="tag">{{item.count}}æœ¬è£…</text>
            </view>
            <view class="goods-desc">å¹³å‡æ¯æœ¬ Â¥{{item.averagePrice}}</view>
          </view>
          <view class="goods-price">
            <view class="price">Â¥{{item.price}}</view>
            <view class="quantity">x{{item.quantity}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- é…é€æ–¹å¼ -->
    <view class="delivery-section">
      <view class="section-header">
        <view class="section-icon">ğŸšš</view>
        <view class="section-title">é…é€æ–¹å¼</view>
      </view>
      
      <!-- å…é‚®æç¤º -->
      <view wx:if="{{showFreeShippingTip}}" class="free-shipping-tip">
        <text class="tip-icon">ğŸ’°</text>
        <text class="tip-text">{{freeShippingTipText}}</text>
      </view>
      
      <view class="delivery-options">
        <view class="delivery-option {{deliveryType === 'express' ? 'selected' : ''}}" bindtap="onSelectDelivery" data-type="express">
          <view class="radio-btn">
            <view class="radio-inner {{deliveryType === 'express' ? 'checked' : ''}}"></view>
          </view>
          <view class="option-info">
            <view class="option-title">å¿«é€’é…é€</view>
            <view class="option-desc">{{shippingTime}} Â· {{deliveryCompany}}</view>
          </view>
        </view>
        
        <view class="delivery-option {{deliveryType === 'pickup' ? 'selected' : ''}}" bindtap="onSelectDelivery" data-type="pickup">
          <view class="radio-btn">
            <view class="radio-inner {{deliveryType === 'pickup' ? 'checked' : ''}}"></view>
          </view>
          <view class="option-info">
            <view class="option-title">é—¨åº—è‡ªå–</view>
            <view class="option-desc">è¥ä¸šæ—¶é—´åˆ°åº—è‡ªå– Â· å…è¿è´¹</view>
          </view>
        </view>
      </view>
    </view>

    <!-- è®¢å•å¤‡æ³¨ -->
    <view class="compact-note-section">
      <view class="compact-note-header">
        <text class="compact-note-icon">ğŸ“</text>
        <text class="compact-note-title">è®¢å•å¤‡æ³¨</text>
      </view>
      <view class="compact-note-wrapper">
        <textarea 
          placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰" 
          value="{{orderNote}}"
          bindinput="onNoteInput"
          maxlength="100"
          class="compact-note-input"
        ></textarea>
      </view>
    </view>

    <!-- æ”¯ä»˜æ–¹å¼ -->
    <view class="payment-section">
      <view class="section-header">
        <view class="section-icon">ğŸ’³</view>
        <view class="section-title">æ”¯ä»˜æ–¹å¼</view>
      </view>
      
      <view class="payment-option selected">
        <view class="radio-btn">
          <view class="radio-inner checked"></view>
        </view>
        <view class="payment-info">
          <view class="payment-icon">ğŸ’š</view>
          <view class="payment-name">å¾®ä¿¡æ”¯ä»˜</view>
        </view>
        <view class="payment-check">âœ“</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ”¯ä»˜æ  -->
  <view class="bottom-payment">
    <view class="price-detail">
      <view class="price-row">
        <text class="price-label">å•†å“é‡‘é¢:</text>
        <text class="price-value">Â¥{{orderAmount}}</text>
      </view>
      <view class="price-row">
        <text class="price-label">é¦–å•ä¼˜æƒ :</text>
        <text class="price-value discount">-Â¥{{firstDiscount}}</text>
      </view>
      <view class="price-row">
        <text class="price-label">æ»¡å‡ä¼˜æƒ :</text>
        <text class="price-value discount">-Â¥{{fullDiscount}}</text>
      </view>
      <view class="price-row">
        <text class="price-label">è¿è´¹:</text>
        <text class="price-value free">{{deliveryFee === 0 ? 'åŒ…é‚®' : 'Â¥' + deliveryFee}}</text>
      </view>
      <view class="total-row">
        <text class="total-label">åº”ä»˜é‡‘é¢:</text>
        <text class="total-value">Â¥{{finalAmount}}</text>
      </view>
    </view>
    
    <view class="payment-btn" bindtap="onConfirmPayment">
      ç¡®è®¤æ”¯ä»˜
    </view>
    
    <view class="payment-tip">ç‚¹å‡»æ”¯ä»˜å³åŒæ„ã€Šç”¨æˆ·åè®®ã€‹</view>
  </view>
</view>