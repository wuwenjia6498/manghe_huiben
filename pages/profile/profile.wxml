<!--pages/profile/profile.wxml-->
<view class="profile-container">
  <!-- 上半部分：用户信息区域 -->
  <view class="profile-header">
    <!-- 自定义导航栏 -->
    <view class="custom-navbar">
      <view class="navbar-left"></view>
      <view class="navbar-center"></view>
      <view class="navbar-right" catchtap="onSettingsTap">
        <view class="settings-icon">⚙</view>
      </view>
    </view>

    <!-- 用户信息区域（统一样式） -->
    <view class="user-info">
      <view class="user-content">
        <!-- 头像区域 - 可点击编辑 -->
        <view class="user-avatar-wrapper" bindtap="onEditAvatar">
          <button 
            class="avatar-edit-btn" 
            open-type="chooseAvatar" 
            bindchooseavatar="onChooseAvatar">
            <image 
              wx:if="{{userInfo && userInfo.avatar}}" 
              src="{{userInfo.avatar}}" 
              class="avatar-image" />
            <view wx:else class="default-avatar">👤</view>
            <view class="avatar-edit-mask">
              <text class="edit-icon">📷</text>
            </view>
          </button>
          <view class="avatar-tip">{{userInfo && userInfo.avatar ? '点击更换头像' : '点击设置头像'}}</view>
        </view>
        
        <!-- 昵称区域 - 可点击编辑 -->
        <view class="user-details">
          <view class="user-name-edit" bindtap="onEditNickname">
            <text class="name-text">{{displayName}}</text>
            <text class="edit-hint">✏️</text>
          </view>
        </view>
      </view>
    </view>


  </view>

  <!-- 下半部分：功能列表 -->
  <view class="profile-content">
    <!-- 订单管理 -->
    <view class="section">
      <view class="section-header">
        <view class="section-icon">🛍</view>
        <view class="section-title">订单管理</view>
      </view>
      
      <view class="menu-list">
        <view class="menu-item" bindtap="onOrdersTap" data-type="pending">
          <view class="item-icon unpaid">💳</view>
          <view class="item-info">
            <view class="item-title">
              <text>待支付</text>
              <text class="order-count" wx:if="{{orderCounts.pending > 0}}">({{orderCounts.pending}})</text>
            </view>
            <view class="item-desc">查看待支付订单</view>
          </view>
          <view class="item-arrow">></view>
        </view>
        
        <view class="menu-item" bindtap="onOrdersTap" data-type="paid">
          <view class="item-icon pending">📦</view>
          <view class="item-info">
            <view class="item-title">
              <text>待发货</text>
              <text class="order-count" wx:if="{{orderCounts.paid > 0}}">({{orderCounts.paid}})</text>
            </view>
            <view class="item-desc">查看待发货订单</view>
          </view>
          <view class="item-arrow">></view>
        </view>
        
        <view class="menu-item" bindtap="onOrdersTap" data-type="shipped">
          <view class="item-icon shipping">🚚</view>
          <view class="item-info">
            <view class="item-title">
              <text>待收货</text>
              <text class="order-count" wx:if="{{orderCounts.shipped > 0}}">({{orderCounts.shipped}})</text>
            </view>
            <view class="item-desc">查看运输中订单</view>
          </view>
          <view class="item-arrow">></view>
        </view>
        
        <view class="menu-item" bindtap="onOrdersTap" data-type="all">
          <view class="item-icon all">📋</view>
          <view class="item-info">
            <view class="item-title">
              <text>全部订单</text>
              <text class="order-count" wx:if="{{orderCounts.all > 0}}">({{orderCounts.all}})</text>
            </view>
            <view class="item-desc">查看所有订单</view>
          </view>
          <view class="item-arrow">></view>
        </view>
      </view>
    </view>

    <!-- 更多功能 -->
    <view class="section">
      <view class="section-header">
        <view class="section-icon">⋯</view>
        <view class="section-title">更多功能</view>
      </view>
      
      <view class="menu-list">
        <view class="menu-item" bindtap="onAddressTap">
          <view class="item-icon address">📍</view>
          <view class="item-info">
            <view class="item-title">收货地址</view>
            <view class="item-desc">管理收货地址信息</view>
          </view>
          <view class="item-arrow">></view>
        </view>
        
        <view class="menu-item" bindtap="onCustomerServiceTap">
          <view class="item-icon service">💬</view>
          <view class="item-info">
            <view class="item-title">联系客服</view>
            <view class="item-desc">在线客服支持</view>
          </view>
          <view class="item-arrow">></view>
        </view>
        
        <view class="menu-item" bindtap="onAgreementTap">
          <view class="item-icon agreement">📄</view>
          <view class="item-info">
            <view class="item-title">用户协议</view>
            <view class="item-desc">查看服务条款</view>
          </view>
          <view class="item-arrow">></view>
        </view>
        
        <view class="menu-item" bindtap="onPrivacyTap">
          <view class="item-icon privacy">🛡</view>
          <view class="item-info">
            <view class="item-title">隐私政策</view>
            <view class="item-desc">了解隐私保护</view>
          </view>
          <view class="item-arrow">></view>
        </view>
        
        <view class="menu-item" bindtap="onAboutTap">
          <view class="item-icon about">ℹ</view>
          <view class="item-info">
            <view class="item-title">关于我们</view>
            <view class="item-desc">了解盲盒</view>
          </view>
          <view class="item-arrow">></view>
        </view>
      </view>
      
      <!-- 管理端入口 -->
      <view class="admin-entry" bindtap="enterAdminMode">
        <view class="item-icon admin">👨‍💼</view>
        <view class="item-info">
          <view class="item-title">管理后台</view>
          <view class="item-desc">进入管理端系统</view>
        </view>
        <view class="item-arrow">></view>
      </view>
    </view>

    <!-- 版权信息 -->
    <view class="footer">
      <view class="app-version">绘本盲盒小程序 v1.0.0</view>
      <view class="copyright">© 2025. All rights reserved.</view>
    </view>
  </view>

  <!-- 关于我们自定义弹窗 -->
  <view class="about-modal" wx:if="{{showAboutModal}}" bindtap="onCloseAboutModal">
    <view class="about-modal-content" catchtap="onModalContentTap">
      <!-- 顶部图标 -->
      <view class="about-header">
        <!-- 右上角关闭按钮 -->
        <view class="about-close-icon" bindtap="onCloseAboutModal">✕</view>
        <view class="about-icon">📚</view>
        <view class="about-title">关于我们</view>
      </view>
      
      <!-- 内容区域 -->
      <view class="about-body">
        <view class="about-paragraph">
          <text class="about-text">绘本盲盒在帮助本馆优化库存管理的同时，也为家长提供了高性价比的优质绘本选择。</text>
        </view>
        
        <view class="about-paragraph">
          <text class="about-text">我们根据孩子的年龄段（0-3岁 / 3-6岁 / 6岁以上）进行精准推荐，并支持多种品相选择（从全新到五成新）。</text>
        </view>
        
        <view class="about-paragraph">
          <text class="about-text">通过盲盒这一形式，不仅让购书过程充满趣味，也让孩子的阅读成长之路时刻满载惊喜与期待。</text>
        </view>
        
        <!-- 特色标签 -->
        <view class="about-features">
          <view class="feature-tag">📖 适龄推荐</view>
          <view class="feature-tag">✨ 品质保证</view>
          <view class="feature-tag">🎁 惊喜盲盒</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 客服二维码弹窗 -->
  <view class="qrcode-modal" wx:if="{{showQrcodeModal}}" catchtap="onCloseQrcode">
    <view class="qrcode-content" catchtap="{{''}}">
      <view class="qrcode-title">添加客服微信</view>
      <image class="qrcode-image" src="/images/wechat-qrcode.png" mode="aspectFit"></image>
      <view class="qrcode-tips">扫描二维码添加客服微信</view>
      <view class="qrcode-info">工作时间：09:00 - 21:00</view>
      <view class="qrcode-close" bindtap="onCloseQrcode">关闭</view>
    </view>
  </view>
</view>