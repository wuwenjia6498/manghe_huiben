# 用户状态逻辑说明

## 📅 更新日期
2025-10-19

## 🎯 目标
澄清用户状态管理逻辑，避免混淆。

---

## 📊 **核心概念区分**

### 1. **账号状态（数据库字段 `status`）**
这是管理员可以控制的用户权限状态：

| 数据库值 | 含义 | 权限说明 |
|---------|------|---------|
| `active` | 正常 | 可以正常使用所有功能 |
| `inactive` | 受限 | 部分功能受限制 |
| `blocked` | 封禁 | 完全禁止访问 |

### 2. **用户等级（自动计算）**
这是根据消费数据自动判断的用户价值等级：

| 条件 | 显示等级 | 说明 |
|------|---------|------|
| 订单≥10 或 消费≥¥1000 | VIP用户 | 高价值用户 |
| 订单<10 且 消费<¥1000 | 普通用户 | 一般用户 |

### 3. **最终显示逻辑**

```javascript
if (status === 'blocked') {
  显示：已封禁
} else if (status === 'inactive') {
  显示：已限制
} else if (status === 'active') {
  if (订单≥10 或 消费≥¥1000) {
    显示：VIP用户
  } else {
    显示：普通用户
  }
}
```

---

## 🔄 **状态修改流程**

### **按钮操作 → 数据库状态 → 显示结果**

#### 1. **点击"✅ 设为正常用户"**
```
设置：status = 'active'
↓
系统判断消费数据
↓
高消费：显示"VIP用户"
低消费：显示"普通用户"
```

#### 2. **点击"⚠️ 限制访问"**
```
设置：status = 'inactive'
↓
显示："已限制"
（无论消费多少）
```

#### 3. **点击"🚫 封禁用户"**
```
设置：status = 'blocked'
↓
显示："已封禁"
（无论消费多少）
```

---

## 🔍 **筛选器逻辑**

| 筛选器按钮 | 筛选条件 | 说明 |
|-----------|---------|------|
| **全部用户** | 所有用户 | 不过滤 |
| **VIP用户** | `status='active'` 且（订单≥10 或 消费≥¥1000） | 高价值正常用户 |
| **普通用户** | `status='active'` 且（订单<10 且 消费<¥1000） | 一般正常用户 |
| **受限用户** | `status='inactive'` | 被限制的用户 |
| **已封禁** | `status='blocked'` | 被封禁的用户 |

---

## ✅ **修复后的逻辑清晰度**

### **修复前的问题：**
```
❌ 筛选"普通用户" → 显示"已限制"用户
❌ "设为正常" → 可能显示"VIP"
❌ 逻辑混乱，用户困惑
```

### **修复后：**
```
✅ 筛选"普通用户" → 显示低消费的正常用户
✅ 筛选"VIP用户" → 显示高消费的正常用户
✅ 筛选"受限用户" → 显示被限制的用户
✅ 逻辑清晰，一目了然
```

---

## 📝 **使用场景示例**

### **场景1：新注册用户**
```
初始状态：status = 'active', 订单 = 0, 消费 = ¥0
显示：普通用户
筛选器：在"普通用户"中显示
```

### **场景2：消费增长**
```
用户下了15单，消费¥2000
状态：status = 'active' (未改变)
显示：VIP用户 ✨ (自动升级)
筛选器：从"普通用户"移到"VIP用户"
```

### **场景3：管理员限制用户**
```
管理员点击：⚠️ 限制访问
状态：status = 'inactive'
显示：已限制
筛选器：在"受限用户"中显示
备注：即使之前是VIP，也会显示"已限制"
```

### **场景4：解除限制**
```
管理员点击：✅ 设为正常用户
状态：status = 'active'
显示：根据消费自动判断
  - 如果订单≥10或消费≥¥1000 → VIP用户
  - 否则 → 普通用户
筛选器：回到"VIP用户"或"普通用户"
```

### **场景5：封禁违规用户**
```
管理员点击：🚫 封禁用户
状态：status = 'blocked'
显示：已封禁
筛选器：在"已封禁"中显示
备注：即使是VIP，也会显示"已封禁"
```

---

## 🎨 **界面显示对应关系**

### **用户卡片显示：**
```
┌─────────────────────────────────┐
│ 👤 张三                [VIP用户] [修改] │  ← VIP = active + 高消费
│                                 │
│ 订单：15单 | 消费：¥2580        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 👤 李四              [普通用户] [修改] │  ← 普通 = active + 低消费
│                                 │
│ 订单：3单 | 消费：¥280          │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 👤 王五              [已限制] [修改]   │  ← 已限制 = inactive
│                                 │
│ 订单：20单 | 消费：¥5000        │  ← 即使消费高也显示"已限制"
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 👤 赵六              [已封禁] [修改]   │  ← 已封禁 = blocked
│                                 │
│ 订单：0单 | 消费：¥0            │
└─────────────────────────────────┘
```

---

## 💡 **关键理解**

### **1. 两个维度**
- **账号状态（管理员控制）**：正常/受限/封禁
- **用户等级（自动计算）**：VIP/普通

### **2. 优先级**
```
账号状态 > 用户等级

即：
- 如果是受限/封禁 → 直接显示受限/封禁
- 如果是正常 → 再看用户等级（VIP/普通）
```

### **3. 动态变化**
- **用户等级**会随消费自动变化
- **账号状态**只能由管理员手动修改

---

## 🔑 **记忆口诀**

```
正常用户看消费，高消VIP低消普
受限封禁看状态，不管消费都显示
筛选分类五个档，全部VIP普通限禁
```

---

## 📋 **数据库字段说明**

| 字段 | 类型 | 可选值 | 说明 |
|-----|------|--------|------|
| `status` | String | `active`、`inactive`、`blocked` | 账号状态 |
| `orderCount` | Number | 0~N | 订单总数 |
| `totalAmount` | Number | 0.00~N | 消费总金额 |

**重要：** 数据库中**没有**存储用户等级（VIP/普通），这是前端根据 `orderCount` 和 `totalAmount` 实时计算的。

---

## ✨ **优势**

### **灵活性**
- 用户等级自动升降，无需手动调整
- 管理员只需关注账号状态（正常/受限/封禁）

### **准确性**
- 用户消费变化立即反映在等级上
- 避免等级数据过时

### **可扩展性**
- 未来可以调整VIP门槛（如改为20单或2000元）
- 可以增加更多等级（如超级VIP、钻石VIP等）

---

## 🎯 **总结**

**核心原则：**
1. 数据库只存储账号状态（3种）
2. 用户等级由消费自动计算（2种）
3. 显示优先级：账号状态 > 用户等级
4. 筛选逻辑：按最终显示结果分类

**这样设计的好处：**
- ✅ 逻辑清晰
- ✅ 维护简单
- ✅ 自动化程度高
- ✅ 避免数据不一致

---

**现在用户状态逻辑完全清晰了！** 🎉

