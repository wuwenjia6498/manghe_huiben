# 绘本租赁小程序 📚

一个基于微信小程序的绘本租赁平台，提供完整的商品浏览、购物车、订单管理和支付功能。

---

## 📋 项目概述

### 核心功能
- ✅ **用户端完整功能**：浏览商品、购物车、下单、支付、订单管理
- ✅ **管理端完整功能**：数据看板、商品管理、订单管理、用户管理、系统设置
- ✅ **微信云开发集成**：数据库、云函数、云存储
- ✅ **微信支付V3集成**：完整的支付流程和回调处理
- ✅ **用户认证系统**：静默登录、用户信息管理

### 技术栈
- **前端**：微信小程序原生开发
- **后端**：微信云开发 + 云函数
- **数据库**：微信云数据库
- **存储**：微信云存储
- **支付**：微信支付V3 API

---

## 🚀 快速开始

### 1. 环境要求
- 微信开发者工具
- 微信小程序账号
- 微信云开发环境

### 2. 项目配置

#### 2.1 克隆项目
```bash
git clone <repository-url>
cd manghe_huiben
```

#### 2.2 配置云环境
编辑 `env.js` 和 `cloud/env.js`，填入你的云环境ID：
```javascript
const ENV_ID = 'your-env-id'; // 替换为你的云环境ID
```

#### 2.3 部署云函数
在微信开发者工具中：
1. 右键 `cloud/functions` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待所有云函数部署完成

#### 2.4 初始化数据库
1. 在云开发控制台创建以下集合：
   - `users` - 用户表
   - `products` - 商品表
   - `categories` - 分类表
   - `orders` - 订单表
   - `addresses` - 地址表
   - `cart` - 购物车表
   - `settings` - 系统设置表

2. 运行初始化脚本（可选）：
   - 打开小程序，进入管理后台
   - 系统会自动创建初始数据

详细配置请参考 `docs/development/CLOUD_SETUP.md`

### 3. 开始开发
1. 使用微信开发者工具打开项目
2. 编译运行
3. 体验完整功能

---

## 📱 功能模块

### 用户端
- **首页**：商品展示、公告通知
- **购物车**：商品管理、数量调整、批量操作
- **订单**：下单、支付、订单列表、订单详情
- **地址**：地址列表、添加/编辑地址
- **个人中心**：用户信息、订单管理、客服联系

### 管理端
- **数据看板**：销售统计、订单统计、用户统计
- **商品管理**：商品CRUD、上下架、库存管理
- **订单管理**：订单处理、发货、退款
- **用户管理**：用户列表、状态管理、活跃度追踪
- **系统设置**：配送设置、优惠活动、系统配置

---

## 🏗️ 项目结构

```
manghe_huiben/
├── app.js                      # 小程序入口
├── app.json                    # 小程序配置
├── app.wxss                    # 全局样式
├── env.js                      # 环境配置
│
├── pages/                      # 页面目录
│   ├── home/                   # 首页
│   ├── cart/                   # 购物车
│   ├── order/                  # 订单确认
│   ├── orders/                 # 订单列表
│   ├── order-detail/           # 订单详情
│   ├── address/                # 地址列表
│   ├── address-edit/           # 地址编辑
│   ├── product-detail/         # 商品详情
│   ├── profile/                # 个人中心
│   ├── agreement/              # 用户协议
│   ├── privacy/                # 隐私政策
│   ├── admin/                  # 管理后台首页
│   ├── admin-products/         # 商品管理
│   ├── admin-orders/           # 订单管理
│   ├── admin-users/            # 用户管理
│   └── admin-settings/         # 系统设置
│
├── cloud/                      # 云开发
│   ├── env.js                  # 云环境配置
│   ├── database/               # 数据库初始化脚本
│   └── functions/              # 云函数
│       ├── auth/               # 用户认证
│       ├── admin/              # 管理功能
│       ├── user/               # 用户功能
│       ├── product/            # 商品功能
│       ├── cart/               # 购物车功能
│       ├── order/              # 订单功能
│       ├── init/               # 数据初始化
│       ├── createPayment/      # 创建支付
│       └── paymentNotify/      # 支付回调
│
├── utils/                      # 工具函数
│   ├── api.js                  # API封装
│   ├── util.js                 # 通用工具
│   ├── paymentSDK.js           # 支付SDK
│   └── productService.js       # 商品服务
│
├── images/                     # 图片资源
├── user-ui/                    # UI设计图
├── docs/                       # 文档目录
│   ├── development/            # 开发文档
│   ├── archive/                # 归档文档
│   └── 用户管理功能手册.md     # 用户管理手册
│
├── scripts/                    # 工具脚本
│   ├── 清理无效头像数据.js     # 清理脚本
│   └── 清除用户数据脚本.js     # 数据清理
│
└── README.md                   # 项目说明（本文档）
```

---

## 📚 核心文档

### 必读文档
1. **README.md** - 项目总览（本文档）
2. **ADMIN_GUIDE.md** - 管理后台使用指南
3. **docs/development/CLOUD_SETUP.md** - 云开发配置指南
4. **项目最终结构说明.md** - 完整项目结构说明

### 功能文档
1. **docs/用户管理功能手册.md** - 用户管理详细说明
2. **用户协议与隐私政策功能说明.md** - 协议相关说明
3. **联系客服二维码弹窗说明.md** - 客服功能说明
4. **数据看板快捷入口功能说明.md** - 数据看板说明

### 开发文档
1. **docs/development/微信支付常见问题解决.md** - 支付问题解决
2. **docs/development/支付功能测试指南.md** - 支付测试指南
3. **docs/development/回调地址配置指南.md** - 回调配置

### 管理文档
1. **管理员数据操作指南.md** - 数据库操作规范（⚠️ 重要）

---

## 🔧 云函数说明

### auth（用户认证）
- `login` - 用户登录
- `getUserInfo` - 获取用户信息
- `updateUserInfo` - 更新用户信息
- `checkAdmin` - 检查管理员权限

### admin（管理功能）
- `getUsers` - 获取用户列表
- `getUserOrderStats` - 获取用户订单统计
- `updateUserStatus` - 更新用户状态
- `getProducts` - 获取商品列表
- `addProduct` - 添加商品
- `updateProduct` - 更新商品
- `deleteProduct` - 删除商品
- `getOrders` - 获取订单列表
- `updateOrderStatus` - 更新订单状态
- `getSettings` - 获取系统设置
- `updateSettings` - 更新系统设置
- `getStats` - 获取统计数据

### user（用户功能）
- `updateUserProfile` - 更新用户资料
- `getAddresses` - 获取地址列表
- `addAddress` - 添加地址
- `updateUserAddress` - 更新地址
- `deleteAddress` - 删除地址

### product（商品功能）
- `getProductList` - 获取商品列表
- `getProductDetail` - 获取商品详情

### cart（购物车）
- `addToCart` - 添加到购物车
- `updateCart` - 更新购物车
- `removeFromCart` - 从购物车移除
- `getCart` - 获取购物车

### order（订单）
- `createOrder` - 创建订单
- `getOrderList` - 获取订单列表
- `getOrderDetail` - 获取订单详情
- `cancelOrder` - 取消订单

### createPayment（创建支付）
- 创建微信支付订单
- 返回支付参数

### paymentNotify（支付回调）
- 处理微信支付回调
- 更新订单状态

### init（数据初始化）
- 初始化商品数据
- 初始化分类数据

---

## 🎨 设计规范

### 色彩系统
- **主色**：#EF5BA6（粉色）
- **成功**：#07C160（绿色）
- **警告**：#FA8C15（橙色）
- **错误**：#EE0A24（红色）
- **文本**：#333333、#666666、#999999
- **背景**：#F8F8F8

### 字体规范
- **大标题**：36rpx - 48rpx
- **标题**：32rpx
- **正文**：28rpx - 30rpx
- **辅助**：24rpx - 26rpx

### 间距规范
- **小间距**：16rpx
- **中间距**：32rpx
- **大间距**：48rpx

---

## 🔐 权限管理

### 管理员权限
管理员可以访问所有管理端功能。设置管理员：
1. 在云开发控制台打开 `users` 集合
2. 找到目标用户
3. 将 `isAdmin` 字段设置为 `true`

### 用户状态
- **active**：正常用户，可以正常使用
- **blocked**：封禁用户，无法使用小程序

---

## 💳 支付配置

### 微信支付V3配置
1. 获取商户号和API密钥
2. 配置回调地址
3. 上传API证书
4. 测试支付流程

详细配置请参考：
- `docs/development/支付功能测试指南.md`
- `docs/development/回调地址配置指南.md`

---

## 🐛 常见问题

### 1. 云函数调用失败
- 检查云环境ID是否正确
- 确认云函数已成功部署
- 查看云函数日志排查错误

### 2. 数据库权限错误
- 确认数据库权限设置正确
- 云函数调用使用管理员权限

### 3. 支付失败
- 检查商户号配置
- 确认回调地址正确
- 查看支付日志

### 4. 头像不显示
- 确认使用云存储URL（cloud://）
- 不要保存临时文件路径（wxfile://）
- 重新上传头像

---

## 📈 项目状态

### 完成度：100% ✅

- ✅ 用户端完整功能
- ✅ 管理端完整功能
- ✅ 云开发集成
- ✅ 支付功能集成
- ✅ 代码优化清理
- ✅ 文档完善

### 可以上线 🚀

项目已完成所有核心功能开发，经过测试和优化，可以立即投入使用。

---

## 📞 技术支持

如有问题，请查阅相关文档或提交Issue。

---

## 📄 许可证

本项目采用 MIT 许可证。

---

**最后更新：** 2025-10-19  
**项目版本：** 1.0  
**状态：** ✅ 生产就绪
