# 数据看板快捷入口功能说明

## ✨ 新增功能

为数据看板的两个关键卡片添加了快捷跳转功能：

### 1. 待发货订单 → 订单管理页（自动筛选待发货）
点击"待发货订单"卡片的"点击处理"按钮，会跳转到订单管理页并自动筛选出待发货订单。

### 2. 库存预警 → 商品管理页（自动筛选低库存）
点击"库存预警"卡片的"需要补货"按钮，会跳转到商品管理页并自动筛选出低库存商品（库存 ≤ 10）。

## 🔧 实现细节

### 文件修改

#### 1. 数据看板页面 (`pages/admin/admin.js`)

**修改方法**：
- `onPendingOrdersTap()` - 待发货订单点击
- `onInventoryWarningTap()` - 库存预警点击

**实现逻辑**：
```javascript
// 跳转到订单管理页，并传递筛选参数
wx.navigateTo({
  url: '/pages/admin-orders/admin-orders?filter=paid'
});

// 跳转到商品管理页，并传递筛选参数
wx.navigateTo({
  url: '/pages/admin-products/admin-products?filter=lowStock'
});
```

#### 2. 订单管理页面 (`pages/admin-orders/admin-orders.js`)

**修改位置**：`onLoad(options)` 方法

**功能**：接收URL参数 `filter=paid`，自动设置筛选条件为待发货

```javascript
onLoad(options) {
  if (options.filter) {
    this.setData({
      currentFilter: options.filter  // 设置为 'paid'
    });
  }
}
```

**效果**：页面加载后自动显示待发货订单

#### 3. 商品管理页面 (`pages/admin-products/admin-products.js`)

**新增方法**：`filterLowStock()` - 筛选低库存商品

**修改位置**：
- `onLoad(options)` 方法 - 接收URL参数
- `loadProductsFromDatabase()` 方法 - 数据加载完成后应用筛选

**筛选逻辑**：
```javascript
filterLowStock() {
  // 筛选库存 <= 10 且状态为 active 的商品
  const lowStockSkus = group.skus.filter(sku => 
    sku.stock <= 10 && sku.status === 'active'
  );
  
  // 显示筛选结果提示
  wx.showToast({
    title: `发现 ${lowStockCount} 个低库存商品`
  });
}
```

## 📋 使用流程

### 场景1：处理待发货订单

```
数据看板
  ↓
点击"待发货订单"卡片的"点击处理"
  ↓
跳转到订单管理页
  ↓
自动筛选显示待发货订单（18个）
  ↓
可以进行批量发货、单个发货等操作
```

### 场景2：补充低库存商品

```
数据看板
  ↓
点击"库存预警"卡片的"需要补货"
  ↓
跳转到商品管理页
  ↓
自动筛选显示低库存商品（库存 ≤ 10）
  ↓
可以编辑库存、修改价格等操作
```

## 🎯 功能特点

### 1. 智能筛选
- **订单管理**：自动筛选 `pending` 和 `paid` 状态的订单
- **商品管理**：自动筛选库存 ≤ 10 且状态为活跃的商品

### 2. 友好提示
- 跳转成功后显示筛选结果数量
- 如果没有符合条件的项目，显示相应提示

### 3. 无缝体验
- 一键直达需要处理的内容
- 省去手动筛选的步骤
- 提高管理效率

## 📊 示例效果

### 待发货订单跳转

**点击前**：数据看板显示"待发货订单：18"

**点击后**：
```
订单管理页面
┌─────────────────────────┐
│ 全部(22) 待发货(18) ... │  ← 自动选中"待发货"
├─────────────────────────┤
│ 订单1 - 待发货          │
│ 订单2 - 待发货          │
│ ...                     │
│ 订单18 - 待发货         │
└─────────────────────────┘
```

### 库存预警跳转

**点击前**：数据看板显示"库存预警：1"

**点击后**：
```
商品管理页面
┌─────────────────────────┐
│ 🔔 发现 3 个低库存商品   │  ← 提示信息
├─────────────────────────┤
│ 0-3岁 全新 10本装       │
│ 库存：5 ⚠️              │
│                         │
│ 3-6岁 九成新 20本装     │
│ 库存：8 ⚠️              │
│                         │
│ 6-12岁 七成新 15本装    │
│ 库存：3 ⚠️              │
└─────────────────────────┘
```

## 🔍 技术说明

### URL参数传递

使用小程序的URL参数机制：
```javascript
// 传递参数
wx.navigateTo({
  url: '/pages/xxx?filter=value'
});

// 接收参数
onLoad(options) {
  const filter = options.filter;  // 获取 'value'
}
```

### 筛选时机

- **订单管理页**：在 `onLoad` 阶段设置筛选条件，数据加载后自动应用
- **商品管理页**：在数据加载完成后（`loadProductsFromDatabase` 末尾）应用筛选

### 低库存标准

根据云函数统计逻辑，低库存定义为：
```javascript
stock <= 10  // 库存小于等于10个
```

与数据看板的统计保持一致。

## ⚡ 性能优化

### 1. 延迟筛选
商品管理页使用 `pendingFilter` 标记，等数据加载完成后再筛选，避免重复查询。

### 2. 单次跳转
使用 `wx.navigateTo` 而不是 `wx.redirectTo`，保留页面栈，方便返回。

### 3. 错误处理
跳转失败时显示友好提示，不会导致页面卡死。

## 🚀 后续优化建议

1. **添加返回按钮提示**
   - 在筛选页面顶部显示"从数据看板跳转"标识
   - 提供快速返回数据看板的按钮

2. **记住筛选状态**
   - 离开页面后保持筛选状态
   - 方便用户继续处理

3. **数据实时刷新**
   - 订单发货后，自动更新数据看板数字
   - 库存补充后，自动更新预警数量

4. **更多快捷入口**
   - 添加"新增用户"快捷入口
   - 添加"今日订单"快捷查看

---

**功能完成时间**: 2025-10-16  
**实现人员**: AI助手  
**测试状态**: 待测试 ⏳

